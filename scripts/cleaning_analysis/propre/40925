{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Importations et Nettoyage de la base de données : "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import sqlite3\n",
    "import pandas as pd\n",
    "from skimpy import skim\n",
    "import numpy as np\n",
    "import seaborn as sns\n",
    "import missingno as msno\n",
    "import re\n",
    "from datetime import datetime\n",
    "from collections import defaultdict\n",
    "import math"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Importation de la class de nettoyage de la BDD\n",
    "from nettoyage import Nettoyage"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Connexion à la base de données SQLite\n",
    "connexion = sqlite3.connect('/Users/f.b/Desktop/Data_Science/Clock_industry/Scripts/Data/montre.db')\n",
    "\n",
    "# Exécution d'une requête SQL pour récupérer des données et conversion en DataFrame\n",
    "df = pd.read_sql_query('SELECT * FROM montre', connexion)\n",
    "\n",
    "# Fermeture de la connexion\n",
    "connexion.close()\n",
    "\n",
    "# Conversion de la base en format CSV \n",
    "df.to_csv('/Users/f.b/Desktop/Data_Science/Clock_industry/Scripts/Data/watches_database.csv')\n",
    "\n",
    "# Chargement de la BDD sans la colonne id: \n",
    "df = df.iloc[:, 1:]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "nettoyage = Nettoyage(df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = nettoyage.nettoyer_colonnes()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "colonnes_a_renseigner = ['matiere_boitier',\n",
    "                         'matiere_bracelet',\n",
    "                         'sexe',\n",
    "                         'diametre',\n",
    "                         'etencheite',\n",
    "                         'matiere_lunette',\n",
    "                         'matiere_verre',\n",
    "                         'boucle',\n",
    "                         'matiere_boucle',\n",
    "                         'rouage',\n",
    "                         'reserve_de_marche']\n",
    "\n",
    "for col in colonnes_a_renseigner:\n",
    "    df = nettoyage.remplissage(col)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = nettoyage.remplissage_mouvement()\n",
    "df = nettoyage.remplissage_reserve_marche()\n",
    "df = nettoyage.add_function_count_column('fonctions')\n",
    "df = nettoyage.suppression_colonnes()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = nettoyage.nettoyage_marque()\n",
    "df = nettoyage.nettoyage_modele()\n",
    "df = nettoyage.nettoyage_mouvement()\n",
    "df = nettoyage.nettoyer_matiere_boitier()\n",
    "df = nettoyage.extraction_matiere_bracelet('matiere_bracelet')\n",
    "df = nettoyage.nettoyage_sexe()\n",
    "df = nettoyage.application_extraction_annee()\n",
    "df = nettoyage.regroupement_etat_montres()\n",
    "df = nettoyage.extraction_elements_avant_euro()\n",
    "df = nettoyage.nettoyer_valeurs('prix')\n",
    "df = nettoyage.extraction_chiffres_reserve_de_marche()\n",
    "df = nettoyage.extraction_chiffres_etencheite()\n",
    "df = nettoyage.extraction_chiffres_diametre()\n",
    "df = nettoyage.extraction_matiere_lunette()\n",
    "df = nettoyage.extraction_matiere_boucle()\n",
    "df = nettoyage.nettoyage_matiere_verre_et_boucle()\n",
    "df = nettoyage.nettoyage_ville()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>marque</th>\n",
       "      <th>modele</th>\n",
       "      <th>mouvement</th>\n",
       "      <th>matiere_boitier</th>\n",
       "      <th>matiere_bracelet</th>\n",
       "      <th>annee_prod</th>\n",
       "      <th>etat</th>\n",
       "      <th>sexe</th>\n",
       "      <th>prix</th>\n",
       "      <th>reserve_de_marche</th>\n",
       "      <th>diametre</th>\n",
       "      <th>etencheite</th>\n",
       "      <th>matiere_lunette</th>\n",
       "      <th>matiere_verre</th>\n",
       "      <th>boucle</th>\n",
       "      <th>matiere_boucle</th>\n",
       "      <th>comptage_fonctions</th>\n",
       "      <th>pays</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ROLEX</td>\n",
       "      <td>DATEJUST-36</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>HOMME</td>\n",
       "      <td>10437.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>36.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>GRANDE-BRETAGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ZENO-WATCH-BASEL</td>\n",
       "      <td>X-LARGE-RETRO</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>INCONNUE</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>HOMME</td>\n",
       "      <td>699.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>44.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>BOUCLE_ARDILLON</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>ESPAGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ROLEX</td>\n",
       "      <td>YACHT-MASTER-40</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>OR_ACIER</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>HOMME</td>\n",
       "      <td>21215.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>40.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>INCONNUE</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>OR</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>POLOGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ROLEX</td>\n",
       "      <td>DATEJUST-II</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>HOMME</td>\n",
       "      <td>10437.0</td>\n",
       "      <td>48.0</td>\n",
       "      <td>41.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>GRANDE-BRETAGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>PANERAI</td>\n",
       "      <td>LUMINOR-MARINA</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>CUIR</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Neuf</td>\n",
       "      <td>HOMME</td>\n",
       "      <td>7300.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>36.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>0</td>\n",
       "      <td>ALLEMAGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47850</th>\n",
       "      <td>CARTIER</td>\n",
       "      <td>TORTUE</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>OR_BLANC</td>\n",
       "      <td>CUIR</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>FEMME</td>\n",
       "      <td>39900.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>38.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>OR</td>\n",
       "      <td>MINÉRAL</td>\n",
       "      <td>BOUCLE_ARDILLON</td>\n",
       "      <td>OR</td>\n",
       "      <td>0</td>\n",
       "      <td>RÉPUBLIQUE_TCHEQUE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47853</th>\n",
       "      <td>ROLEX</td>\n",
       "      <td>DATEJUST-31</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>OR_JAUNE</td>\n",
       "      <td>OR</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>FEMME</td>\n",
       "      <td>15700.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>31.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>OR</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>OR</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>ALLEMAGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47861</th>\n",
       "      <td>TIFFANY</td>\n",
       "      <td>CT60</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>CUIR</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>FEMME</td>\n",
       "      <td>5448.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>34.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>DOUBLE_PLIS</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>POLOGNE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47862</th>\n",
       "      <td>ROLEX</td>\n",
       "      <td>OYSTER-PERPETUAL-26</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Bon</td>\n",
       "      <td>FEMME</td>\n",
       "      <td>4797.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>26.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>DANEMARK</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47864</th>\n",
       "      <td>FREDERIQUE-CONSTANT</td>\n",
       "      <td>LADIES-AUTOMATIC-HEART-BEAT</td>\n",
       "      <td>AUTOMATIQUE</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>2024.0</td>\n",
       "      <td>État non spécifié</td>\n",
       "      <td>FEMME</td>\n",
       "      <td>1623.0</td>\n",
       "      <td>38.0</td>\n",
       "      <td>34.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>SAPHIR</td>\n",
       "      <td>PLIS</td>\n",
       "      <td>ACIER</td>\n",
       "      <td>Non_renseignée</td>\n",
       "      <td>ITALIE</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>23100 rows × 18 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                    marque                       modele    mouvement  \\\n",
       "0                    ROLEX                  DATEJUST-36  AUTOMATIQUE   \n",
       "1         ZENO-WATCH-BASEL                X-LARGE-RETRO  AUTOMATIQUE   \n",
       "2                    ROLEX              YACHT-MASTER-40  AUTOMATIQUE   \n",
       "3                    ROLEX                  DATEJUST-II  AUTOMATIQUE   \n",
       "5                  PANERAI               LUMINOR-MARINA  AUTOMATIQUE   \n",
       "...                    ...                          ...          ...   \n",
       "47850              CARTIER                       TORTUE  AUTOMATIQUE   \n",
       "47853                ROLEX                  DATEJUST-31  AUTOMATIQUE   \n",
       "47861              TIFFANY                         CT60  AUTOMATIQUE   \n",
       "47862                ROLEX          OYSTER-PERPETUAL-26  AUTOMATIQUE   \n",
       "47864  FREDERIQUE-CONSTANT  LADIES-AUTOMATIC-HEART-BEAT  AUTOMATIQUE   \n",
       "\n",
       "      matiere_boitier matiere_bracelet  annee_prod               etat   sexe  \\\n",
       "0               ACIER            ACIER         NaN                Bon  HOMME   \n",
       "1               ACIER         INCONNUE         NaN                Bon  HOMME   \n",
       "2            OR_ACIER            ACIER         NaN                Bon  HOMME   \n",
       "3               ACIER            ACIER         NaN                Bon  HOMME   \n",
       "5               ACIER             CUIR         NaN               Neuf  HOMME   \n",
       "...               ...              ...         ...                ...    ...   \n",
       "47850        OR_BLANC             CUIR         NaN                Bon  FEMME   \n",
       "47853        OR_JAUNE               OR         NaN                Bon  FEMME   \n",
       "47861           ACIER             CUIR         NaN                Bon  FEMME   \n",
       "47862           ACIER            ACIER         NaN                Bon  FEMME   \n",
       "47864           ACIER            ACIER      2024.0  État non spécifié  FEMME   \n",
       "\n",
       "          prix  reserve_de_marche  diametre  etencheite matiere_lunette  \\\n",
       "0      10437.0               70.0      36.0        10.0           ACIER   \n",
       "1        699.0               42.0      44.0         3.0           ACIER   \n",
       "2      21215.0               70.0      40.0        10.0        INCONNUE   \n",
       "3      10437.0               48.0      41.0        10.0           ACIER   \n",
       "5       7300.0               72.0      36.0         3.0           ACIER   \n",
       "...        ...                ...       ...         ...             ...   \n",
       "47850  39900.0                NaN      38.0         NaN              OR   \n",
       "47853  15700.0               42.0      31.0        10.0              OR   \n",
       "47861   5448.0               42.0      34.0        10.0           ACIER   \n",
       "47862   4797.0               42.0      26.0        10.0           ACIER   \n",
       "47864   1623.0               38.0      34.0         5.0           ACIER   \n",
       "\n",
       "      matiere_verre           boucle matiere_boucle comptage_fonctions  \\\n",
       "0            SAPHIR             PLIS          ACIER     Non_renseignée   \n",
       "1            SAPHIR  BOUCLE_ARDILLON          ACIER     Non_renseignée   \n",
       "2            SAPHIR             PLIS             OR     Non_renseignée   \n",
       "3            SAPHIR             PLIS          ACIER     Non_renseignée   \n",
       "5            SAPHIR             PLIS          ACIER                  0   \n",
       "...             ...              ...            ...                ...   \n",
       "47850       MINÉRAL  BOUCLE_ARDILLON             OR                  0   \n",
       "47853        SAPHIR             PLIS             OR     Non_renseignée   \n",
       "47861        SAPHIR      DOUBLE_PLIS          ACIER     Non_renseignée   \n",
       "47862        SAPHIR             PLIS          ACIER     Non_renseignée   \n",
       "47864        SAPHIR             PLIS          ACIER     Non_renseignée   \n",
       "\n",
       "                     pays  \n",
       "0         GRANDE-BRETAGNE  \n",
       "1                 ESPAGNE  \n",
       "2                 POLOGNE  \n",
       "3         GRANDE-BRETAGNE  \n",
       "5               ALLEMAGNE  \n",
       "...                   ...  \n",
       "47850  RÉPUBLIQUE_TCHEQUE  \n",
       "47853           ALLEMAGNE  \n",
       "47861             POLOGNE  \n",
       "47862            DANEMARK  \n",
       "47864              ITALIE  \n",
       "\n",
       "[23100 rows x 18 columns]"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "base",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
